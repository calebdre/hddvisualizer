<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>HDD Visualizer</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/5.3.2/sweetalert2.min.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<div class="clearfix">
            <ul class="sidebar">
                <li class="top header">HDD Visualizer</li>

                <li class="header">Analysis</li>
                <li>Start Analysis</li>
                <li class="disabled">Filter</li>
                <li class="disabled">Share</li>
                <li class="disabled">Periodic</li>
                <li class="disabled">Delete File</li>
                <li class="disabled">Change Permissions</li>

                <li class="header">Settings</li>
                <!-- modal options: bubble color, window size,  -->
                <li>Analysis Interface</li>
                <!-- modal options: language, font size, boot on start  -->
                <li>Application</li>
            </ul>
            <div class="content">
                <div class="analysis">
                    <div class="analysis"></div>
                    <div class="stats">
                        <figure class="stat">
                            <h2>--</h2>
                            <figcaption>Directories</figcaption>
                        </figure>

                        <figure class="stat">
                            <h2>--</h2>
                            <figcaption>Files</figcaption>
                        </figure>

                        <figure class="stat">
                            <h2>--</h2>
                            <figcaption>Memory</figcaption>
                        </figure>
                    </div>
                </div>
            </div>
		</div>
		<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
        <script src="https://d3js.org/d3.v3.js"></script>
        <script src="jsnetworkx.js"></script>
        <script src="https://cdn.jsdelivr.net/sweetalert2/5.3.2/sweetalert2.min.js"></script>
		<script src="app.js"></script>
		<script>
            var analysisHeight = window.innerHeight * .8;
            var statsHeight = window.innerHeight * .2;

			$(".analysis .analysis").first().css('min-height', analysisHeight + "px");
            $('.sidebar').css("height", window.innerHeight + "px");

            $.get("http://localhost:4567/analyze", function(data){
                var G = new jsnx.Graph();
                var edgeData = [];
               for(var i = 0; i < data.length; i++){
                   var file = data[i];
                   G.addNode(i, file);
                   var edgeIndex;
                   var path = file.path.substr(0, file.path.lastIndexOf("/") + 1);
                   if(edgeData.indexOf(path) === -1){
                       edgeIndex = data.length + edgeData.push(path) + 1;
                       G.addNode(edgeIndex, {
                           name: path,
                           isPath: true,
                           index: edgeIndex
                       });
                   }else{
                       edgeIndex = edgeData.indexOf(path) + data.length + 1;
                   }

                   G.addEdge(i, edgeIndex);
                   console.log({target: i, parent: edgeIndex});
               }

                draw(G);

                for (var node of G) {
                    console.log(node);
                    node.on("click", function(){
                        console.log("This is possible");
                    })
                }
            });

            function draw(G){
                jsnx.draw(G, {
                    element: ".analysis .analysis",
                    height: analysisHeight,
                    withLabels:true,
                    labels:function(d){
                      return d.data.name;
                    },
                    nodeAttr:{

                    },
                    nodeStyle:{
                        fill: function(d){
                            console.log(d.data);
                            if(d.data.hasOwnProperty("isPath")){
                                return "blue";
                            }else{
                                return "red";
                            }
                        }
                    }
                });
            }
		</script>
	</body>
</html>
