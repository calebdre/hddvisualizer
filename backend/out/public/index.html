<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>HDD Visualizer</title>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<div class="container">
			<div class="info-area">
				<div class="login section">
					<h2 class="title">Login</h2>

					<div class="form-group">
						<label for="username">Username</label>
						<input type="username" class="form-control" id="username" placeholder="email">
					</div>
					<div class="form-group">
						<label for="username">Password</label>
						<input type="password" class="form-control" id="password" placeholder="password">
					</div>

					<button id="login-submit" type="submit" class="btn btn-default">Submit</button>
				</div>
				<div class="analysis-empty section">
					<div class="well">
						<p>Welcome to HDDVisualizer.</p>
						<p>You don't have an analysis right now. Please press the plus button to start an analysis.</p>
					</div>
				</div>
				<div class="section analysis visible">
					
				</div>
				<div class="share section">
					<h2 class="title">Share Your Analysis</h2>
					<div class="form-group">
						<label for="files">Files:</label>
						<select class="form-control" name="files" id="files" multiple>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
							<option value="file1">file1</option>
						</select>
					</div>

					<div class="form-group">
						<label for="share-to-user">User</label>
						<input type="text" class="form-control" id="share-to-user" placeholder="type the username to share to'">
					</div>

					<button id="share-submit" type="submit" class="btn btn-default">Submit</button>
				</div>

				<div class="filter section">
					<h2 class="title">Filter by Size</h2>
					<div class="form-group">
						<label for="min-size">Minimum Size</label>
						<select name="min-size" id="min-size" class="form-control">
							<opten value="2">2mb</opten>
							<opten value="50">50mb</opten>
							<opten value="100">100mb</opten>
							<opten value="1000">1000mb</opten>
						</select>
					</div>
					<div class="form-group">
						<label for="max-size">Maximum Size</label>
						<select name="max-size" id="max-size" class="form-control">
							<opten value="2">2mb</opten>
							<opten value="50">50mb</opten>
							<opten value="100">100mb</opten>
							<opten value="1000">1000mb</opten>
						</select>
					</div>
					<button id="filter-submit" type="submit" class="btn btn-default">Submit</button>
				</div>
			</div>
			<ul class="action-area">
				<li class="analyze-btn popup-btn"> <button class="btn"> <i class="fa fa-bar-chart"></i></button></li>
				<li class="share-btn popup-btn"> <button class="btn"> <i class="fa fa-share"></i></button></li>
				<li class="filter-btn popup-btn"> <button class="btn"> <i class="fa fa-filter"></i></button></li>
				<li class="settings-btn popup-btn"> <button class="btn"> <i class="fa fa-cog"></i></button></li>
				<li class="action-btn circle-btn">+</li>
			</ul>
		</div>
		<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
		<script src="https://d3js.org/d3.v3.js"></script>
		<script src="app.js"></script>
		<script>
			new HoverButtonListener(['analyze', 'settings','share','filter']).listen();
			$('.container').first().css('height', window.innerHeight + "px");
            var width = 1000;
            var height = 1000;
			var svg = d3.select(".section.analysis").append("svg")
                    .attr('width', width)
                    .attr('height',height);

            var force = d3.layout.force()
                    .gravity(.05)
                    .distance(100)
                    .charge(-100)
                    .size([width, height]);

            d3.json("http://localhost:4567/analyze", function(json){
                var nodes = [];
                var linksMap = {};
                var links = [];

                for(var i = 0; i < json.length; i++){
                    var file = json[i];
                    nodes.push({"name": file.name});
                    if(!linksMap.hasOwnProperty(file.path)){
                        linksMap[file.path] = [];
                    }

                    linksMap[file.path].push(i);
                }

                for(var key in linksMap){
                    index = nodes.length;
                    nodes.push(key);
                    for(var i = 0; i < linksMap[key].length; i++){
                        links.push({
                            "source": { "index" : index},
                            "target": { "index" : linksMap[key][i]},
                            "weight": 1
                        });
                    }
                }

                force.nodes(nodes)
                        .links(links)
                        .start();

                var link = svg.selectAll(".link")
                        .data(links)
                        .enter().append("line")
                        .attr("class", "link")
                        .style("stroke-width", function(){
                            return 1;
                        });

                var node = svg.selectAll(".node")
                        .data(nodes)
                        .enter().append("g")
                        .attr("class", "node")
                        .call(force.drag);

                node.append("circle")
                        .attr("r","5");

                node.append("text")
                        .attr("dx", 12)
                        .attr("dy", ".35em")
                        .text(function(d) { return d.name });

                force.on("tick", function() {
                    link.attr("x1", function(d) {
                        return d.source.x;
                    })
                            .attr("y1", function(d) { return d.source.y; })
                            .attr("x2", function(d) { return d.target.x; })
                            .attr("y2", function(d) { return d.target.y; });

                    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
                });
            });
		</script>
	</body>
</html>
